# Math Multi-Agent Architecture

## Overview

<p align="center">
    <img src="../../../../docs/drmas/math_multi_agent_workflow.png" alt="Math Multi-Agent Workflow" width="80%">
</p>

This is an iterative two-agent architecture designed for mathematical problem solving tasks. The architecture follows an iterative refinement approach with two specialized agents: a Solver Agent that generates step-by-step solutions, and a Verifier Agent that reviews and validates the solutions. The agents work collaboratively in an iterative loop until solutions are approved or a maximum iteration limit is reached.

## Iterative Architecture

The architecture is organized into an iterative loop with two specialized agents:

### Agent 1: Solver Agent
- **Role**: Generates step-by-step solutions to mathematical problems
- **Layer Position**: Execution agent - runs first in each iteration
- **Input**: Original problem + all historical solution attempts + context
- **Output**: Step-by-step reasoning with final answer in `\boxed{}` format
- **Behavior**: Carefully reasons through the math problem step by step, considering previous attempts as auxiliary context

### Agent 2: Verifier Agent
- **Role**: Reviews and validates solutions generated by the Solver Agent
- **Layer Position**: Validation agent - runs after Solver Agent in each iteration
- **Input**: Original problem + Solver Agent's solution + all historical context
- **Output**: Critical review with verdict in `<verify>approve</verify>` or `<verify>reject</verify>` format
- **Behavior**: Checks each reasoning step, formula, and conclusion for accuracy, completeness, and logical consistency
- **Verdict Logic**:
  - `approve`: All steps and the final answer are correct → Mark as approved, exit loop for this item
  - `reject`: Issues detected → Continue to next iteration for this item

## Execution Flow

The iterative execution follows a refinement loop approach:

```
Iteration Loop (max_loop_num iterations):
  Loop i:
    1. Solver Agent → Generates solution for not-yet-approved items
       │
       └─ Updates team context with solution
    
    2. Verifier Agent → Reviews solution (skip on last iteration)
       │
       ├─ If "approve" → Mark item as approved → Skip in future iterations
       └─ If "reject" → Continue to next iteration
    
    3. If all items approved → Exit loop early
    4. If max_loop_num reached → Exit loop
```

The architecture supports parallel processing of multiple problems, with each problem tracked independently through the approval process. Once a problem is approved by the Verifier Agent, it is excluded from subsequent iterations, allowing the system to focus computational resources on problems that still need refinement.